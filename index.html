<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeamTodo - í†µí•© ê²€ì¦ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .validation-error {
            animation: shake 0.3s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .validation-success {
            animation: pulse 0.5s ease-in-out;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .status-connected {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        .status-demo {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        .status-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        /* Todo í•­ëª© ê³ ê¸‰ ìŠ¤íƒ€ì¼ */
        .todo-item {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .todo-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-left-color: #667eea;
        }
        
        .todo-item.completed {
            opacity: 0.7;
            background-color: #f9fafb;
        }
        
        /* ìš°ì„ ìˆœìœ„ í‘œì‹œ */
        .priority-high { border-left-color: #ef4444 !important; }
        .priority-medium { border-left-color: #f59e0b !important; }
        .priority-low { border-left-color: #10b981 !important; }
        
        /* í™œë™ í”¼ë“œ ìŠ¤íƒ€ì¼ */
        .activity-item {
            transition: background-color 0.2s ease;
        }
        
        .activity-item:hover {
            background-color: #f3f4f6;
        }
        
        /* ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜ */
        .btn-animate {
            transition: all 0.2s ease;
        }
        
        .btn-animate:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* í†µê³„ ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ */
        .stat-card {
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: scale(1.05);
        }
        
        /* í•„í„° ë²„íŠ¼ í™œì„±í™” ìŠ¤íƒ€ì¼ */
        .filter-btn {
            transition: all 0.2s ease;
        }
        
        .filter-btn:hover {
            transform: translateY(-1px);
        }
        
        /* ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ ì• ë‹ˆë©”ì´ì…˜ */
        .migration-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* ë°˜ì‘í˜• ê°œì„  */
        @media (max-width: 768px) {
            .todo-item {
                padding: 1rem;
            }
            
            .todo-item .flex {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .todo-actions {
                display: flex;
                gap: 0.5rem;
                width: 100%;
            }
            
            .todo-actions button {
                flex: 1;
            }
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- ì—°ê²° ìƒíƒœ í‘œì‹œ -->
    <div id="connectionStatus" class="connection-status status-demo">
        <div class="status-indicator"></div>
        <span id="statusText">ì—°ê²° í™•ì¸ ì¤‘...</span>
    </div>

    <!-- ë¡œë”© ìƒíƒœ -->
    <div id="loading" class="fixed inset-0 gradient-bg flex items-center justify-center z-50">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-white text-lg" id="loadingText">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</p>
            <div class="mt-4 bg-white bg-opacity-20 rounded-lg p-4 max-w-md">
                <div class="text-white text-sm" id="loadingSteps">
                    <div id="step1" class="opacity-50">âœ“ Supabase ì—°ê²° í™•ì¸</div>
                    <div id="step2" class="opacity-50">â—‹ ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸</div>
                    <div id="step3" class="opacity-50">â—‹ ì¸ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™”</div>
                    <div id="step4" class="opacity-50">â—‹ ê²€ì¦ ì‹œìŠ¤í…œ ë¡œë“œ</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ -->
    <div id="authScreen" class="hidden min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="max-w-md w-full bg-white rounded-lg shadow-xl p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">TeamTodo</h1>
                <p class="text-gray-600">í†µí•© ê²€ì¦ ì‹œìŠ¤í…œì´ ì ìš©ëœ í˜‘ì—… ë„êµ¬</p>
                <div id="supabaseStatus" class="mt-4 p-3 bg-gray-50 rounded-lg">
                    <div class="text-sm font-medium text-gray-700">ì—°ê²° ìƒíƒœ</div>
                    <div id="statusDetails" class="text-xs text-gray-500 mt-1">í™•ì¸ ì¤‘...</div>
                </div>
            </div>

            <!-- íƒ­ ë²„íŠ¼ -->
            <div class="flex mb-6 bg-gray-100 rounded-lg p-1">
                <button id="loginTab" class="flex-1 py-2 text-center rounded-md bg-white shadow-sm font-medium text-blue-600 transition-all">
                    ë¡œê·¸ì¸
                </button>
                <button id="signupTab" class="flex-1 py-2 text-center rounded-md font-medium text-gray-600 transition-all">
                    íšŒì›ê°€ì…
                </button>
            </div>

            <!-- ì†Œì…œ ë¡œê·¸ì¸ ì„¹ì…˜ -->
            <div class="space-y-3 mb-6">
                <!-- êµ¬ê¸€ ë¡œê·¸ì¸ ë²„íŠ¼ -->
                <button 
                    id="googleLoginBtn"
                    class="w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 transition-colors"
                >
                    <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Googleë¡œ ë¡œê·¸ì¸
                </button>

                <!-- ë°ëª¨ ë¡œê·¸ì¸ ë²„íŠ¼ (ë°ëª¨ ëª¨ë“œì¼ ë•Œë§Œ í‘œì‹œ) -->
                <button 
                    id="demoLoginBtn"
                    class="w-full flex items-center justify-center px-4 py-2 border border-blue-300 rounded-md shadow-sm bg-blue-50 text-sm font-medium text-blue-600 hover:bg-blue-100 transition-colors hidden"
                >
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd" />
                    </svg>
                    ë°ëª¨ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
                </button>

                <!-- êµ¬ë¶„ì„  -->
                <div class="relative">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">ë˜ëŠ”</span>
                    </div>
                </div>
            </div>

            <!-- ë¡œê·¸ì¸ í¼ -->
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì´ë©”ì¼</label>
                    <input 
                        type="email" 
                        id="loginEmail" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="example@email.com"
                        required
                    >
                    <div id="loginEmailError" class="text-red-500 text-sm mt-1 hidden"></div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ë¹„ë°€ë²ˆí˜¸</label>
                    <input 
                        type="password" 
                        id="loginPassword" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        required
                    >
                    <div id="loginPasswordError" class="text-red-500 text-sm mt-1 hidden"></div>
                </div>
                <button 
                    type="submit" 
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50"
                    id="loginBtn"
                >
                    ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸
                </button>
            </form>

            <!-- íšŒì›ê°€ì… í¼ -->
            <form id="signupForm" class="space-y-4 hidden">
                <!-- ì†Œì…œ íšŒì›ê°€ì… ì„¹ì…˜ -->
                <div class="space-y-3 mb-6">
                    <!-- êµ¬ê¸€ íšŒì›ê°€ì… ë²„íŠ¼ -->
                    <button 
                        type="button"
                        id="googleSignupBtn"
                        class="w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 transition-colors"
                    >
                        <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Googleë¡œ íšŒì›ê°€ì…
                    </button>

                    <!-- êµ¬ë¶„ì„  -->
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-300"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 bg-white text-gray-500">ë˜ëŠ” ì´ë©”ì¼ë¡œ ê°€ì…</span>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì´ë©”ì¼</label>
                    <input 
                        type="email" 
                        id="signupEmail" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="example@email.com"
                    >
                    <div id="signupEmailError" class="text-red-500 text-sm mt-1 hidden"></div>
                    <div id="signupEmailSuccess" class="text-green-500 text-sm mt-1 hidden">âœ“ ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤</div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ìš©ìëª…</label>
                    <input 
                        type="text" 
                        id="signupUsername" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="username"
                    >
                    <div id="signupUsernameError" class="text-red-500 text-sm mt-1 hidden"></div>
                    <div id="signupUsernameSuccess" class="text-green-500 text-sm mt-1 hidden">âœ“ ì‚¬ìš© ê°€ëŠ¥í•œ ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤</div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì „ì²´ ì´ë¦„</label>
                    <input 
                        type="text" 
                        id="signupFullName" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="í™ê¸¸ë™"
                    >
                    <div id="signupFullNameError" class="text-red-500 text-sm mt-1 hidden"></div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ë¹„ë°€ë²ˆí˜¸</label>
                    <input 
                        type="password" 
                        id="signupPassword" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                    >
                    <div id="signupPasswordError" class="text-red-500 text-sm mt-1 hidden"></div>
                    <div class="text-xs text-gray-600 mt-1">
                        8ì ì´ìƒ, ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨
                    </div>
                    <!-- ë¹„ë°€ë²ˆí˜¸ ê°•ë„ í‘œì‹œ -->
                    <div class="mt-2">
                        <div class="flex space-x-1">
                            <div id="strengthBar1" class="h-2 w-1/4 bg-gray-200 rounded"></div>
                            <div id="strengthBar2" class="h-2 w-1/4 bg-gray-200 rounded"></div>
                            <div id="strengthBar3" class="h-2 w-1/4 bg-gray-200 rounded"></div>
                            <div id="strengthBar4" class="h-2 w-1/4 bg-gray-200 rounded"></div>
                        </div>
                        <div id="strengthText" class="text-xs mt-1 text-gray-600"></div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input 
                        type="password" 
                        id="signupPasswordConfirm" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”"
                    >
                    <div id="signupPasswordConfirmError" class="text-red-500 text-sm mt-1 hidden"></div>
                </div>
                <button 
                    type="submit" 
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50"
                    id="signupBtn"
                    disabled
                >
                    ì´ë©”ì¼ë¡œ íšŒì›ê°€ì…
                </button>
            </form>

            <!-- ê²€ì¦ í†µê³„ -->
            <div id="validationStats" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                <h3 class="text-sm font-medium text-gray-700 mb-2">ì‹¤ì‹œê°„ ê²€ì¦ í†µê³„</h3>
                <div class="grid grid-cols-3 gap-2 text-xs">
                    <div class="text-center">
                        <div id="totalValidations" class="font-bold text-blue-600">0</div>
                        <div class="text-gray-600">ì „ì²´</div>
                    </div>
                    <div class="text-center">
                        <div id="successValidations" class="font-bold text-green-600">0</div>
                        <div class="text-gray-600">ì„±ê³µ</div>
                    </div>
                    <div class="text-center">
                        <div id="failedValidations" class="font-bold text-red-600">0</div>
                        <div class="text-gray-600">ì‹¤íŒ¨</div>
                    </div>
                </div>
            </div>

            <!-- ë°ëª¨ ëª¨ë“œ ì•ˆë‚´ -->
            <div id="demoModeNotice" class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg hidden">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">ë°ëª¨ ëª¨ë“œ ì‹¤í–‰ ì¤‘</h3>
                        <div class="mt-2 text-sm text-yellow-700">
                            <p>Supabase ì—°ê²°ì— ì‹¤íŒ¨í•˜ì—¬ ë°ëª¨ ëª¨ë“œë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. ëª¨ë“  ê¸°ëŠ¥ì„ ì²´í—˜í•  ìˆ˜ ìˆì§€ë§Œ ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <div id="mainApp" class="hidden min-h-screen bg-gray-50">
        <!-- í—¤ë” -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-bold text-gray-900">TeamTodo</h1>
                        <span class="ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">ê²€ì¦ ì‹œìŠ¤í…œ í†µí•©</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="userInfo" class="text-sm text-gray-600"></span>
                        <button id="logoutBtn" class="text-sm text-red-600 hover:text-red-800">ë¡œê·¸ì•„ì›ƒ</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- í•  ì¼ ì¶”ê°€ ì„¹ì…˜ -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ìƒˆ í•  ì¼ ì¶”ê°€</h2>
                <form id="todoForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ì œëª© *</label>
                            <input 
                                type="text" 
                                id="todoTitle" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="í•  ì¼ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                required
                            >
                            <div id="todoTitleError" class="text-red-500 text-sm mt-1 hidden"></div>
                            <div id="todoTitleSuccess" class="text-green-500 text-sm mt-1 hidden">âœ“ ìœ íš¨í•œ ì œëª©ì…ë‹ˆë‹¤</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ìš°ì„ ìˆœìœ„</label>
                            <select 
                                id="todoPriority" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            >
                                <option value="low">ë‚®ìŒ</option>
                                <option value="medium" selected>ë³´í†µ</option>
                                <option value="high">ë†’ìŒ</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ì„¤ëª…</label>
                        <textarea 
                            id="todoDescription" 
                            rows="3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="í•  ì¼ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                        ></textarea>
                        <div id="todoDescriptionError" class="text-red-500 text-sm mt-1 hidden"></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ì‹œì‘ ë‚ ì§œ</label>
                            <input 
                                type="date" 
                                id="todoStartDate" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            >
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ë§ˆê° ë‚ ì§œ</label>
                            <input 
                                type="date" 
                                id="todoDueDate" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            >
                            <div id="todoDateError" class="text-red-500 text-sm mt-1 hidden"></div>
                        </div>
                    </div>
                    <button 
                        type="submit" 
                        class="w-full md:w-auto px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50"
                        id="todoSubmitBtn"
                        disabled
                    >
                        í•  ì¼ ì¶”ê°€
                    </button>
                </form>
            </div>

            <!-- ê²€ì¦ ì‹œìŠ¤í…œ ëŒ€ì‹œë³´ë“œ -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ê²€ì¦ ì‹œìŠ¤í…œ ëŒ€ì‹œë³´ë“œ</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600" id="dashTotalValidations">0</div>
                        <div class="text-sm text-blue-600">ì´ ê²€ì¦ íšŸìˆ˜</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-green-600" id="dashSuccessValidations">0</div>
                        <div class="text-sm text-green-600">ì„±ê³µí•œ ê²€ì¦</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-red-600" id="dashFailedValidations">0</div>
                        <div class="text-sm text-red-600">ì‹¤íŒ¨í•œ ê²€ì¦</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600" id="dashSuccessRate">0%</div>
                        <div class="text-sm text-purple-600">ì„±ê³µë¥ </div>
                    </div>
                </div>
            </div>

            <!-- í•  ì¼ ëª©ë¡ ë° ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- ë©”ì¸ í•  ì¼ ì„¹ì…˜ -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-semibold text-gray-900">ğŸ“‹ í•  ì¼ ëª©ë¡</h2>
                            <div class="flex space-x-2">
                                <button onclick="todoManager.clearCompleted()" class="px-3 py-1 text-sm bg-yellow-100 text-yellow-800 rounded-md hover:bg-yellow-200 transition-colors btn-animate">
                                    ğŸ—‘ï¸ ì™„ë£Œ í•­ëª© ì •ë¦¬
                                </button>
                                <button onclick="todoManager.addSampleTodos()" class="px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200 transition-colors btn-animate">
                                    ğŸ“ ìƒ˜í”Œ ì¶”ê°€
                                </button>
                            </div>
                        </div>
                        
                        <!-- í•  ì¼ í•„í„° -->
                        <div class="mb-4 flex space-x-2">
                            <button onclick="todoManager.setFilter('all')" class="filter-btn bg-blue-100 text-blue-800 px-3 py-1 text-sm rounded-md" data-filter="all">ì „ì²´</button>
                            <button onclick="todoManager.setFilter('pending')" class="filter-btn bg-gray-100 text-gray-800 px-3 py-1 text-sm rounded-md hover:bg-gray-200" data-filter="pending">ì§„í–‰ ì¤‘</button>
                            <button onclick="todoManager.setFilter('completed')" class="filter-btn bg-gray-100 text-gray-800 px-3 py-1 text-sm rounded-md hover:bg-gray-200" data-filter="completed">ì™„ë£Œ</button>
                            <button onclick="todoManager.setFilter('high')" class="filter-btn bg-gray-100 text-gray-800 px-3 py-1 text-sm rounded-md hover:bg-gray-200" data-filter="high">ë†’ì€ ìš°ì„ ìˆœìœ„</button>
                        </div>

                        <!-- í•  ì¼ ëª©ë¡ -->
                        <div id="todoList" class="space-y-3 min-h-[300px]">
                            <!-- í•  ì¼ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            <div id="emptyState" class="text-center text-gray-500 py-8">
                                <div class="text-4xl mb-2">ğŸ“</div>
                                <p>ì•„ì§ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                <p class="text-sm">ìœ„ì—ì„œ ìƒˆë¡œìš´ í•  ì¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì‚¬ì´ë“œë°” -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- í†µê³„ ì¹´ë“œ -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“Š í•  ì¼ í˜„í™©</h3>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="text-center p-3 bg-blue-50 rounded-lg stat-card">
                                <div id="totalCount" class="text-2xl font-bold text-blue-600">0</div>
                                <div class="text-sm text-blue-600">ì „ì²´</div>
                            </div>
                            <div class="text-center p-3 bg-green-50 rounded-lg stat-card">
                                <div id="completedCount" class="text-2xl font-bold text-green-600">0</div>
                                <div class="text-sm text-green-600">ì™„ë£Œ</div>
                            </div>
                        </div>
                        <div class="text-center p-3 bg-purple-50 rounded-lg stat-card">
                            <div id="completionRate" class="text-2xl font-bold text-purple-600">0%</div>
                            <div class="text-sm text-purple-600">ì™„ë£Œìœ¨</div>
                        </div>
                    </div>

                    <!-- ìµœê·¼ í™œë™ -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ”” ìµœê·¼ í™œë™</h3>
                        <div id="activityFeed" class="space-y-2 max-h-60 overflow-y-auto custom-scrollbar">
                            <div class="text-center text-gray-500 py-4">
                                <div class="text-2xl mb-2">ğŸ“</div>
                                <p class="text-sm">í™œë™ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>

                    <!-- ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ”„ ë°ì´í„° ë™ê¸°í™”</h3>
                        <div class="space-y-3">
                            <button onclick="migrationManager.exportToSupabase()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm btn-animate">
                                â¬†ï¸ Supabaseë¡œ ì—…ë¡œë“œ
                            </button>
                            <button onclick="migrationManager.importFromSupabase()" class="w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm btn-animate">
                                â¬‡ï¸ Supabaseì—ì„œ ê°€ì ¸ì˜¤ê¸°
                            </button>
                            <button onclick="migrationManager.exportToFile()" class="w-full px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm btn-animate">
                                ğŸ’¾ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
                            </button>
                        </div>
                        <div id="migrationStatus" class="mt-3 text-sm text-gray-600">
                            <!-- ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í‘œì‹œ -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // === 1ë‹¨ê³„: í™˜ê²½ ì¤€ë¹„ ë° ì—°ê²° ì„¤ì • ===
        
        // Supabase ì„¤ì • (ì‹¤ì œ í”„ë¡œì íŠ¸ ì •ë³´ë¡œ êµì²´ë¨)
        const SUPABASE_CONFIG = {
            url: 'https://nlywtmsbkvaggfvezonj.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5seXd0bXNia3ZhZ2dmdmV6b25qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzOTAzMDEsImV4cCI6MjA2NTk2NjMwMX0.FMyZENGZkUHJEp6YFe-VdYT-L3b49si1yu6EvWun01Y'
        };

        // ì „ì—­ ë³€ìˆ˜
        let supabase = null;
        let isSupabaseConnected = false;
        let connectionMode = 'checking'; // 'checking', 'connected', 'demo', 'error'

        // ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        class SystemInitializer {
            constructor() {
                this.initSteps = [
                    { id: 'step1', text: 'âœ“ Supabase ì—°ê²° í™•ì¸', status: 'pending' },
                    { id: 'step2', text: 'âœ“ ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸', status: 'pending' },
                    { id: 'step3', text: 'âœ“ ì¸ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™”', status: 'pending' },
                    { id: 'step4', text: 'âœ“ ê²€ì¦ ì‹œìŠ¤í…œ ë¡œë“œ', status: 'pending' }
                ];
            }

            async initialize() {
                try {
                    // 1ë‹¨ê³„: Supabase ì—°ê²° í™•ì¸
                    await this.updateStep(0, 'processing', 'Supabase ì—°ê²° ì¤‘...');
                    await this.connectSupabase();
                    
                    // 2ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸
                    await this.updateStep(1, 'processing', 'ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸ ì¤‘...');
                    await this.checkDatabase();
                    
                    // 3ë‹¨ê³„: ì¸ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                    await this.updateStep(2, 'processing', 'ì¸ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...');
                    await this.initializeAuth();
                    
                    // 4ë‹¨ê³„: ê²€ì¦ ì‹œìŠ¤í…œ ë¡œë“œ
                    await this.updateStep(3, 'processing', 'ê²€ì¦ ì‹œìŠ¤í…œ ë¡œë“œ ì¤‘...');
                    await this.loadValidationSystem();
                    
                    // ì™„ë£Œ
                    this.showSuccess();
                    
                } catch (error) {
                    console.error('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    this.showError(error);
                }
            }

            async connectSupabase() {
                try {
                    // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
                    supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
                    
                    // ì—°ê²° í…ŒìŠ¤íŠ¸
                    const { data, error } = await supabase.from('validation_rules').select('count').limit(1);
                    
                    if (error) {
                        throw new Error(`ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
                    }
                    
                    isSupabaseConnected = true;
                    connectionMode = 'connected';
                    this.updateConnectionStatus('connected', 'Supabase ì—°ê²°ë¨');
                    await this.updateStep(0, 'completed', 'âœ“ Supabase ì—°ê²° ì™„ë£Œ');
                    
                } catch (error) {
                    console.warn('Supabase ì—°ê²° ì‹¤íŒ¨, ë°ëª¨ ëª¨ë“œë¡œ ì „í™˜:', error);
                    connectionMode = 'demo';
                    this.updateConnectionStatus('demo', 'ë°ëª¨ ëª¨ë“œ');
                    await this.updateStep(0, 'completed', 'âœ“ ë°ëª¨ ëª¨ë“œë¡œ ì—°ê²°');
                }
            }

            async checkDatabase() {
                if (!isSupabaseConnected) {
                    await this.updateStep(1, 'completed', 'âœ“ ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸');
                    return;
                }

                try {
                    // ì£¼ìš” í…Œì´ë¸” ì¡´ì¬ í™•ì¸
                    const tables = ['users', 'todos', 'validation_rules', 'validation_logs'];
                    for (const table of tables) {
                        const { error } = await supabase.from(table).select('count').limit(1);
                        if (error) {
                            throw new Error(`í…Œì´ë¸” ${table} ì ‘ê·¼ ì‹¤íŒ¨: ${error.message}`);
                        }
                    }
                    
                    await this.updateStep(1, 'completed', 'âœ“ ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸ ì™„ë£Œ');
                    
                } catch (error) {
                    throw new Error(`ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸ ì‹¤íŒ¨: ${error.message}`);
                }
            }

            async initializeAuth() {
                if (isSupabaseConnected) {
                    try {
                        const { data: { user } } = await supabase.auth.getUser();
                        await this.updateStep(2, 'completed', 'âœ“ ì¸ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
                    } catch (error) {
                        throw new Error(`ì¸ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`);
                    }
                } else {
                    await this.updateStep(2, 'completed', 'âœ“ ë°ëª¨ ì¸ì¦ ì‹œìŠ¤í…œ ì¤€ë¹„');
                }
            }

            async loadValidationSystem() {
                try {
                    // ê²€ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                    validationSystem = new ValidationSystem();
                    await validationSystem.loadValidationRules();
                    
                    await this.updateStep(3, 'completed', 'âœ“ ê²€ì¦ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ');
                    
                } catch (error) {
                    throw new Error(`ê²€ì¦ ì‹œìŠ¤í…œ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
                }
            }

            async updateStep(stepIndex, status, text) {
                const step = this.initSteps[stepIndex];
                step.status = status;
                step.text = text;
                
                const element = document.getElementById(step.id);
                if (element) {
                    element.textContent = text;
                    element.className = this.getStepClass(status);
                }
                
                // ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ì§€ì—°
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            getStepClass(status) {
                switch (status) {
                    case 'processing': return 'opacity-100 text-yellow-300';
                    case 'completed': return 'opacity-100 text-green-300';
                    case 'error': return 'opacity-100 text-red-300';
                    default: return 'opacity-50';
                }
            }

            updateConnectionStatus(mode, text) {
                const statusElement = document.getElementById('connectionStatus');
                const textElement = document.getElementById('statusText');
                
                if (statusElement && textElement) {
                    statusElement.className = `connection-status status-${mode}`;
                    textElement.textContent = text;
                }

                // ìƒì„¸ ìƒíƒœ ì—…ë°ì´íŠ¸
                this.updateStatusDetails(mode, text);
            }

            updateStatusDetails(mode, text) {
                const detailsElement = document.getElementById('statusDetails');
                if (detailsElement) {
                    const details = {
                        connected: `âœ… ${SUPABASE_CONFIG.url.replace('https://', '')} ì—°ê²°ë¨`,
                        demo: 'âš ï¸ ì˜¤í”„ë¼ì¸ ëª¨ë“œ - ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤',
                        error: 'âŒ ì—°ê²° ì‹¤íŒ¨ - ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”'
                    };
                    detailsElement.textContent = details[mode] || text;
                }

                // ë°ëª¨ ëª¨ë“œ ì•ˆë‚´ ë° ë²„íŠ¼ í‘œì‹œ
                const demoNotice = document.getElementById('demoModeNotice');
                const demoLoginBtn = document.getElementById('demoLoginBtn');
                
                if (demoNotice && demoLoginBtn) {
                    if (mode === 'demo') {
                        demoNotice.classList.remove('hidden');
                        demoLoginBtn.classList.remove('hidden');
                    } else {
                        demoNotice.classList.add('hidden');
                        demoLoginBtn.classList.add('hidden');
                    }
                }
            }

            showSuccess() {
                document.getElementById('loadingText').textContent = 'ì´ˆê¸°í™” ì™„ë£Œ!';
                setTimeout(() => {
                    this.hideLoading();
                    this.initializeUI();
                }, 1000);
            }

            showError(error) {
                document.getElementById('loadingText').textContent = 'ì´ˆê¸°í™” ì‹¤íŒ¨';
                const stepsElement = document.getElementById('loadingSteps');
                stepsElement.innerHTML = `
                    <div class="text-red-300">âŒ ì˜¤ë¥˜: ${error.message}</div>
                    <div class="mt-2 text-yellow-300">ë°ëª¨ ëª¨ë“œë¡œ ì „í™˜í•©ë‹ˆë‹¤...</div>
                `;
                
                // ë°ëª¨ ëª¨ë“œë¡œ í´ë°±
                connectionMode = 'demo';
                this.updateConnectionStatus('demo', 'ë°ëª¨ ëª¨ë“œ');
                
                setTimeout(() => {
                    this.hideLoading();
                    this.initializeUI();
                }, 2000);
            }

            hideLoading() {
                document.getElementById('loading').classList.add('hidden');
            }

            initializeUI() {
                if (isSupabaseConnected) {
                    // Supabase ì—°ê²°ëœ ê²½ìš° ì¸ì¦ ìƒíƒœ í™•ì¸
                    this.checkAuthState();
                } else {
                    // ë°ëª¨ ëª¨ë“œì¸ ê²½ìš° ë°”ë¡œ ë©”ì¸ ì•± í‘œì‹œ
                    this.showDemoMode();
                }
            }

            async checkAuthState() {
                try {
                    const { data: { user } } = await supabase.auth.getUser();
                    if (user) {
                        // ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ìˆëŠ” ê²½ìš°
                        await uiController.handleAuthenticatedUser(user);
                    } else {
                        // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš°
                        uiController.showAuthScreen();
                    }
                } catch (error) {
                    console.error('ì¸ì¦ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                    uiController.showAuthScreen();
                }
            }

            showDemoMode() {
                // ë°ëª¨ ëª¨ë“œ: ìë™ ë¡œê·¸ì¸
                uiController.currentUser = { 
                    email: 'demo@example.com', 
                    user_metadata: { full_name: 'ë°ëª¨ ì‚¬ìš©ì' } 
                };
                uiController.showMainApp();
                uiController.loadTodos();
            }
        }

        // í†µí•© ê²€ì¦ ì‹œìŠ¤í…œ í´ë˜ìŠ¤ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€í•˜ë˜ ì—°ê²° ìƒíƒœì— ë”°ë¼ ë™ì‘)
        class ValidationSystem {
            constructor() {
                this.rules = new Map();
                this.stats = {
                    total: 0,
                    success: 0,
                    failed: 0
                };
                this.debounceTimers = new Map();
            }

            // ê²€ì¦ ê·œì¹™ ë¡œë“œ
            async loadValidationRules() {
                // ê¸°ë³¸ ê·œì¹™ ì„¤ì •
                this.rules.set('email_format', {
                    name: 'email_format',
                    type: 'email',
                    pattern: '^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$',
                    error_message: 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤'
                });
                this.rules.set('password_strength', {
                    name: 'password_strength',
                    type: 'password',
                    pattern: '',
                    error_message: 'ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©°, ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤'
                });
                this.rules.set('username_format', {
                    name: 'username_format',
                    type: 'username',
                    pattern: '^[a-zA-Z][a-zA-Z0-9_]{2,19}$',
                    error_message: 'ì‚¬ìš©ìëª…ì€ ì˜ë¬¸ìœ¼ë¡œ ì‹œì‘í•˜ë©°, 3-20ìì˜ ì˜ë¬¸, ìˆ«ì, ì–¸ë”ìŠ¤ì½”ì–´ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤'
                });
                this.rules.set('todo_title', {
                    name: 'todo_title',
                    type: 'text',
                    pattern: '',
                    error_message: 'í•  ì¼ ì œëª©ì€ 2ì ì´ìƒ 100ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤'
                });

                // Supabaseì—ì„œ ì¶”ê°€ ê·œì¹™ ë¡œë“œ (ì—°ê²°ëœ ê²½ìš°ë§Œ)
                if (isSupabaseConnected) {
                    try {
                        const { data: rules, error } = await supabase
                            .from('validation_rules')
                            .select('*')
                            .eq('is_active', true);
                        
                        if (!error && rules) {
                            rules.forEach(rule => {
                                this.rules.set(rule.name, rule);
                            });
                        }
                    } catch (error) {
                        console.warn('Supabase ê²€ì¦ ê·œì¹™ ë¡œë“œ ì‹¤íŒ¨:', error);
                    }
                }
            }

            // ì‹¤ì‹œê°„ ê²€ì¦ (ë””ë°”ìš´ì‹± ì ìš©)
            validateField(fieldName, value, callback, delay = 300) {
                // ê¸°ì¡´ íƒ€ì´ë¨¸ ì·¨ì†Œ
                if (this.debounceTimers.has(fieldName)) {
                    clearTimeout(this.debounceTimers.get(fieldName));
                }

                // ìƒˆ íƒ€ì´ë¨¸ ì„¤ì •
                const timer = setTimeout(async () => {
                    const result = await this.performValidation(fieldName, value);
                    callback(result);
                    this.updateStats(result.isValid);
                    await this.logValidation(fieldName, value, result);
                }, delay);

                this.debounceTimers.set(fieldName, timer);
            }

            // ê²€ì¦ ìˆ˜í–‰
            async performValidation(fieldName, value) {
                const rules = this.getValidationRules(fieldName);
                const errors = [];

                for (const rule of rules) {
                    const result = await this.applyRule(rule, value);
                    if (!result.isValid) {
                        errors.push(result.message);
                    }
                }

                return {
                    isValid: errors.length === 0,
                    errors: errors,
                    fieldName: fieldName,
                    value: value
                };
            }

            // í•„ë“œë³„ ê²€ì¦ ê·œì¹™ ë°˜í™˜
            getValidationRules(fieldName) {
                const ruleMap = {
                    'email': ['email_format'],
                    'password': ['password_strength'],
                    'username': ['username_format'],
                    'todoTitle': ['todo_title']
                };

                const ruleNames = ruleMap[fieldName] || [];
                return ruleNames.map(name => this.rules.get(name)).filter(Boolean);
            }

            // ê°œë³„ ê·œì¹™ ì ìš©
            async applyRule(rule, value) {
                switch (rule.type) {
                    case 'email':
                        return this.validateEmail(value, rule);
                    case 'password':
                        return this.validatePassword(value, rule);
                    case 'username':
                        return this.validateUsername(value, rule);
                    case 'text':
                        return this.validateText(value, rule);
                    default:
                        return { isValid: true, message: '' };
                }
            }

            // ì´ë©”ì¼ ê²€ì¦
            validateEmail(email, rule) {
                const pattern = new RegExp(rule.pattern);
                const isValid = pattern.test(email);
                return {
                    isValid: isValid,
                    message: isValid ? '' : rule.error_message
                };
            }

            // ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
            validatePassword(password, rule) {
                const checks = {
                    length: password.length >= 8,
                    uppercase: /[A-Z]/.test(password),
                    lowercase: /[a-z]/.test(password),
                    number: /\d/.test(password),
                    special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
                };

                const isValid = Object.values(checks).every(check => check);
                return {
                    isValid: isValid,
                    message: isValid ? '' : rule.error_message,
                    strength: this.calculatePasswordStrength(checks)
                };
            }

            // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ê³„ì‚°
            calculatePasswordStrength(checks) {
                const score = Object.values(checks).filter(check => check).length;
                if (score === 5) return { level: 4, text: 'ë§¤ìš° ê°•í•¨', color: 'green' };
                if (score === 4) return { level: 3, text: 'ê°•í•¨', color: 'blue' };
                if (score === 3) return { level: 2, text: 'ë³´í†µ', color: 'yellow' };
                if (score >= 1) return { level: 1, text: 'ì•½í•¨', color: 'red' };
                return { level: 0, text: 'ë§¤ìš° ì•½í•¨', color: 'red' };
            }

            // ì‚¬ìš©ìëª… ê²€ì¦
            validateUsername(username, rule) {
                const pattern = new RegExp(rule.pattern);
                const isValid = pattern.test(username);
                return {
                    isValid: isValid,
                    message: isValid ? '' : rule.error_message
                };
            }

            // í…ìŠ¤íŠ¸ ê²€ì¦
            validateText(text, rule) {
                let isValid = true;
                let message = '';

                if (rule.name === 'todo_title') {
                    isValid = text.length >= 2 && text.length <= 100;
                    message = isValid ? '' : rule.error_message;
                }

                return { isValid, message };
            }

            // ì¤‘ë³µ í™•ì¸
            async checkDuplicate(fieldName, value) {
                if (!isSupabaseConnected) {
                    // ë°ëª¨ ëª¨ë“œ: í•­ìƒ ì‚¬ìš© ê°€ëŠ¥ìœ¼ë¡œ ë°˜í™˜
                    return { isAvailable: true };
                }

                try {
                    // ìºì‹œ í™•ì¸
                    const { data: cached } = await supabase
                        .from('duplicate_check_cache')
                        .select('*')
                        .eq('field_name', fieldName)
                        .eq('field_value', value)
                        .gt('expires_at', new Date().toISOString())
                        .single();

                    if (cached) {
                        return { isAvailable: cached.is_available };
                    }

                    // ì‹¤ì œ ì¤‘ë³µ í™•ì¸
                    let query = supabase.from('users').select('id');
                    if (fieldName === 'email') {
                        query = query.eq('email', value);
                    } else if (fieldName === 'username') {
                        query = query.eq('nickname', value);
                    }

                    const { data, error } = await query;
                    if (error) throw error;

                    const isAvailable = data.length === 0;

                    // ìºì‹œì— ì €ì¥
                    await supabase.from('duplicate_check_cache').upsert({
                        field_name: fieldName,
                        field_value: value,
                        is_available: isAvailable,
                        expires_at: new Date(Date.now() + 60 * 60 * 1000).toISOString()
                    });

                    return { isAvailable };
                } catch (error) {
                    console.error('ì¤‘ë³µ í™•ì¸ ì‹¤íŒ¨:', error);
                    return { isAvailable: false };
                }
            }

            // ê²€ì¦ ë¡œê·¸ ì €ì¥
            async logValidation(fieldName, value, result) {
                if (!isSupabaseConnected) return;

                try {
                    const user = await supabase.auth.getUser();
                    if (!user.data.user) return;

                    await supabase.from('validation_logs').insert({
                        user_id: user.data.user.id,
                        field_name: fieldName,
                        field_value: value,
                        is_valid: result.isValid,
                        error_message: result.errors?.join(', ') || null,
                        user_agent: navigator.userAgent
                    });
                } catch (error) {
                    console.error('ê²€ì¦ ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:', error);
                }
            }

            // í†µê³„ ì—…ë°ì´íŠ¸
            updateStats(isValid) {
                this.stats.total++;
                if (isValid) {
                    this.stats.success++;
                } else {
                    this.stats.failed++;
                }

                // UI ì—…ë°ì´íŠ¸
                this.updateStatsUI();
            }

            // í†µê³„ UI ì—…ë°ì´íŠ¸
            updateStatsUI() {
                const successRate = this.stats.total > 0 ? 
                    Math.round((this.stats.success / this.stats.total) * 100) : 0;

                // ì¸ì¦ í™”ë©´ í†µê³„
                const totalElement = document.getElementById('totalValidations');
                const successElement = document.getElementById('successValidations');
                const failedElement = document.getElementById('failedValidations');
                
                if (totalElement) totalElement.textContent = this.stats.total;
                if (successElement) successElement.textContent = this.stats.success;
                if (failedElement) failedElement.textContent = this.stats.failed;

                // ëŒ€ì‹œë³´ë“œ í†µê³„
                const dashTotalElement = document.getElementById('dashTotalValidations');
                const dashSuccessElement = document.getElementById('dashSuccessValidations');
                const dashFailedElement = document.getElementById('dashFailedValidations');
                const dashSuccessRateElement = document.getElementById('dashSuccessRate');

                if (dashTotalElement) dashTotalElement.textContent = this.stats.total;
                if (dashSuccessElement) dashSuccessElement.textContent = this.stats.success;
                if (dashFailedElement) dashFailedElement.textContent = this.stats.failed;
                if (dashSuccessRateElement) dashSuccessRateElement.textContent = successRate + '%';

                // í†µê³„ ì„¹ì…˜ í‘œì‹œ
                const statsElement = document.getElementById('validationStats');
                if (statsElement) statsElement.classList.remove('hidden');
            }

            // ì‚¬ìš©ì ê²€ì¦ í†µê³„ ë¡œë“œ
            async loadUserStats() {
                if (!isSupabaseConnected) return;

                try {
                    const user = await supabase.auth.getUser();
                    if (!user.data.user) return;

                    const { data, error } = await supabase
                        .from('user_validation_stats')
                        .select('*')
                        .eq('user_id', user.data.user.id)
                        .single();

                    if (error && error.code !== 'PGRST116') throw error;

                    if (data) {
                        this.stats = {
                            total: data.total_validations,
                            success: data.successful_validations,
                            failed: data.failed_validations
                        };
                        this.updateStatsUI();
                    }
                } catch (error) {
                    console.error('ì‚¬ìš©ì í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            }
        }

        // ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬ í´ë˜ìŠ¤
        class UserPermissionManager {
            constructor() {
                this.userStatus = null;
                this.userRole = null;
                this.permissions = {};
            }

            // ì‚¬ìš©ì ìƒíƒœ ë° ê¶Œí•œ í™•ì¸
            async checkUserPermissions(user) {
                if (!isSupabaseConnected) {
                    // ë°ëª¨ ëª¨ë“œ: ê¸°ë³¸ ê¶Œí•œ ë¶€ì—¬
                    return {
                        status: 'approved',
                        role: 'user',
                        isApproved: true,
                        isAdmin: false,
                        permissions: {
                            dashboard: true,
                            projects: true,
                            todos: true,
                            calendar: true,
                            admin: false
                        }
                    };
                }

                try {
                    // Supabaseì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
                    const { data, error } = await supabase
                        .from('users')
                        .select('account_status, global_role, approved_by, approved_at')
                        .eq('id', user.id)
                        .single();

                    if (error && error.code !== 'PGRST116') {
                        throw error;
                    }

                    // ìƒˆ ì‚¬ìš©ìì¸ ê²½ìš° ê¸°ë³¸ í”„ë¡œí•„ ìƒì„±
                    if (!data) {
                        await this.createUserProfile(user);
                        return {
                            status: 'pending',
                            role: 'user',
                            isApproved: false,
                            isAdmin: false,
                            permissions: {
                                dashboard: false,
                                projects: false,
                                todos: false,
                                calendar: false,
                                admin: false
                            },
                            isNewUser: true
                        };
                    }

                    const isApproved = data.account_status === 'approved';
                    const isAdmin = data.global_role === 'admin' || data.global_role === 'super_admin';

                    return {
                        status: data.account_status,
                        role: data.global_role,
                        isApproved: isApproved,
                        isAdmin: isAdmin,
                        permissions: this.calculatePermissions(data.account_status, data.global_role)
                    };

                } catch (error) {
                    console.error('ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨:', error);
                    throw error;
                }
            }

            // ìƒˆ ì‚¬ìš©ì í”„ë¡œí•„ ìƒì„±
            async createUserProfile(user) {
                const userData = {
                    id: user.id,
                    email: user.email,
                    full_name: user.user_metadata?.full_name || user.user_metadata?.name || 'ì‚¬ìš©ì',
                    avatar_url: user.user_metadata?.avatar_url || null,
                    account_status: 'pending',
                    global_role: 'user'
                };

                const { error } = await supabase
                    .from('users')
                    .insert(userData);

                if (error) {
                    console.error('ì‚¬ìš©ì í”„ë¡œí•„ ìƒì„± ì‹¤íŒ¨:', error);
                    throw error;
                }

                console.log('ìƒˆ ì‚¬ìš©ì í”„ë¡œí•„ ìƒì„± ì™„ë£Œ');
            }

            // ê¶Œí•œ ê³„ì‚°
            calculatePermissions(status, role) {
                const isApproved = status === 'approved';
                const isAdmin = role === 'admin' || role === 'super_admin';

                return {
                    dashboard: isApproved,
                    projects: isApproved,
                    todos: isApproved,
                    calendar: isApproved,
                    admin: isAdmin
                };
            }

            // ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœ ì²˜ë¦¬
            showPendingApproval(user) {
                const pendingContainer = `
                    <div class="min-h-screen gradient-bg flex items-center justify-center p-4">
                        <div class="max-w-md w-full bg-white rounded-lg shadow-xl p-8 text-center">
                            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-2">ìŠ¹ì¸ ëŒ€ê¸° ì¤‘</h2>
                            <p class="text-gray-600 mb-4">
                                ê³„ì •ì´ ê´€ë¦¬ì ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.<br>
                                ìŠ¹ì¸ì´ ì™„ë£Œë˜ë©´ ëª¨ë“  ê¸°ëŠ¥ì„ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </p>
                            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                                <div class="text-sm text-gray-700">
                                    <div class="flex justify-between mb-2">
                                        <span>ì´ë©”ì¼:</span>
                                        <span class="font-medium">${user.email}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>ì´ë¦„:</span>
                                        <span class="font-medium">${user.user_metadata?.full_name || 'ì‚¬ìš©ì'}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <button onclick="uiController.refreshUserStatus()" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                                    ìƒíƒœ ìƒˆë¡œê³ ì¹¨
                                </button>
                                <button onclick="uiController.handleLogout()" class="w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 transition-colors">
                                    ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.innerHTML = pendingContainer;
            }
        }

        // í•  ì¼ ê´€ë¦¬ ì‹œìŠ¤í…œ
        class TodoManager {
            constructor() {
                this.todos = [];
                this.activities = [];
                this.currentFilter = 'all';
                this.nextId = 1;
            }

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í•  ì¼ ë¡œë“œ
            loadFromStorage() {
                try {
                    const savedTodos = localStorage.getItem('teamtodo_todos');
                    const savedActivities = localStorage.getItem('teamtodo_activities');
                    const savedNextId = localStorage.getItem('teamtodo_nextId');

                    if (savedTodos) {
                        this.todos = JSON.parse(savedTodos);
                    }
                    if (savedActivities) {
                        this.activities = JSON.parse(savedActivities);
                    }
                    if (savedNextId) {
                        this.nextId = parseInt(savedNextId);
                    }
                    this.renderAll();
                } catch (error) {
                    console.error('í•  ì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            }

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— í•  ì¼ ì €ì¥
            saveToStorage() {
                try {
                    localStorage.setItem('teamtodo_todos', JSON.stringify(this.todos));
                    localStorage.setItem('teamtodo_activities', JSON.stringify(this.activities));
                    localStorage.setItem('teamtodo_nextId', this.nextId.toString());
                } catch (error) {
                    console.error('í•  ì¼ ì €ì¥ ì‹¤íŒ¨:', error);
                }
            }

            // í•  ì¼ ì¶”ê°€
            addTodo(title, description, priority, startDate, dueDate) {
                const todo = {
                    id: this.nextId++,
                    title: title.trim(),
                    description: description ? description.trim() : '',
                    priority: priority || 'medium',
                    startDate: startDate || null,
                    dueDate: dueDate || null,
                    completed: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                this.todos.unshift(todo);
                this.addActivity(`"${todo.title}" ì¶”ê°€ë¨`);
                this.saveToStorage();
                this.renderAll();
                return todo;
            }

            // í•  ì¼ í† ê¸€
            toggleTodo(id) {
                const todo = this.todos.find(t => t.id === id);
                if (todo) {
                    todo.completed = !todo.completed;
                    todo.updatedAt = new Date().toISOString();
                    this.addActivity(`"${todo.title}" ${todo.completed ? 'ì™„ë£Œ' : 'ì¬ì‹œì‘'}ë¨`);
                    this.saveToStorage();
                    this.renderAll();
                }
            }

            // í•  ì¼ ìˆ˜ì •
            editTodo(id, newTitle) {
                const todo = this.todos.find(t => t.id === id);
                if (todo && newTitle.trim()) {
                    const oldTitle = todo.title;
                    todo.title = newTitle.trim();
                    todo.updatedAt = new Date().toISOString();
                    this.addActivity(`"${oldTitle}" â†’ "${todo.title}" ìˆ˜ì •ë¨`);
                    this.saveToStorage();
                    this.renderAll();
                }
            }

            // í•  ì¼ ì‚­ì œ
            deleteTodo(id) {
                const todo = this.todos.find(t => t.id === id);
                if (todo && confirm(`"${todo.title}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    this.todos = this.todos.filter(t => t.id !== id);
                    this.addActivity(`"${todo.title}" ì‚­ì œë¨`);
                    this.saveToStorage();
                    this.renderAll();
                }
            }

            // í•„í„° ì„¤ì •
            setFilter(filter) {
                this.currentFilter = filter;
                // í•„í„° ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.className = 'filter-btn bg-gray-100 text-gray-800 px-3 py-1 text-sm rounded-md hover:bg-gray-200';
                });
                document.querySelector(`[data-filter="${filter}"]`).className = 'filter-btn bg-blue-100 text-blue-800 px-3 py-1 text-sm rounded-md';
                this.renderTodos();
            }

            // ì™„ë£Œëœ í•  ì¼ ì •ë¦¬
            clearCompleted() {
                const completedCount = this.todos.filter(t => t.completed).length;
                if (completedCount === 0) {
                    alert('ì™„ë£Œëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                if (confirm(`ì™„ë£Œëœ í•  ì¼ ${completedCount}ê°œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    this.todos = this.todos.filter(t => !t.completed);
                    this.addActivity(`ì™„ë£Œëœ í•  ì¼ ${completedCount}ê°œ ì •ë¦¬ë¨`);
                    this.saveToStorage();
                    this.renderAll();
                }
            }

            // ìƒ˜í”Œ í•  ì¼ ì¶”ê°€
            addSampleTodos() {
                const samples = [
                    { title: 'í”„ë¡œì íŠ¸ ê³„íšì„œ ì‘ì„±', priority: 'high', description: 'ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ì˜ ê³„íšì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.' },
                    { title: 'íšŒì˜ ì¤€ë¹„', priority: 'medium', description: 'ë‚´ì¼ ìˆì„ íŒ€ íšŒì˜ë¥¼ ìœ„í•œ ìë£Œ ì¤€ë¹„' },
                    { title: 'ì´ë©”ì¼ í™•ì¸', priority: 'low', description: 'ë°€ë¦° ì´ë©”ì¼ë“¤ì„ í™•ì¸í•˜ê³  ë‹µì¥í•˜ê¸°' },
                    { title: 'ìš´ë™í•˜ê¸°', priority: 'medium', description: '30ë¶„ ì´ìƒ ìš´ë™í•˜ê¸°' },
                    { title: 'ë…ì„œ', priority: 'low', description: 'ìƒˆë¡œ ì‚° ì±… ì½ê¸°' }
                ];

                samples.forEach(sample => {
                    this.addTodo(sample.title, sample.description, sample.priority);
                });
            }

            // í™œë™ ì¶”ê°€
            addActivity(text) {
                const activity = {
                    id: Date.now(),
                    text: text,
                    time: new Date().toLocaleString('ko-KR')
                };
                
                this.activities.unshift(activity);
                // ìµœëŒ€ 20ê°œ í™œë™ë§Œ ìœ ì§€
                if (this.activities.length > 20) {
                    this.activities = this.activities.slice(0, 20);
                }
            }

            // í•„í„°ë§ëœ í•  ì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            getFilteredTodos() {
                switch (this.currentFilter) {
                    case 'completed':
                        return this.todos.filter(t => t.completed);
                    case 'pending':
                        return this.todos.filter(t => !t.completed);
                    case 'high':
                        return this.todos.filter(t => t.priority === 'high');
                    default:
                        return this.todos;
                }
            }

            // ìš°ì„ ìˆœìœ„ í…ìŠ¤íŠ¸ ë³€í™˜
            getPriorityText(priority) {
                switch (priority) {
                    case 'high': return 'ë†’ìŒ';
                    case 'medium': return 'ë³´í†µ';
                    case 'low': return 'ë‚®ìŒ';
                    default: return priority;
                }
            }

            // ìš°ì„ ìˆœìœ„ ìƒ‰ìƒ í´ë˜ìŠ¤
            getPriorityColor(priority) {
                switch (priority) {
                    case 'high': return 'bg-red-100 text-red-800';
                    case 'medium': return 'bg-yellow-100 text-yellow-800';
                    case 'low': return 'bg-green-100 text-green-800';
                    default: return 'bg-gray-100 text-gray-800';
                }
            }

            // ëª¨ë“  UI ë Œë”ë§
            renderAll() {
                this.renderTodos();
                this.renderStats();
                this.renderActivities();
            }

            // í•  ì¼ ëª©ë¡ ë Œë”ë§
            renderTodos() {
                const todoList = document.getElementById('todoList');
                const emptyState = document.getElementById('emptyState');
                const filteredTodos = this.getFilteredTodos();

                if (filteredTodos.length === 0) {
                    if (emptyState) emptyState.style.display = 'block';
                    todoList.innerHTML = '';
                    return;
                }

                if (emptyState) emptyState.style.display = 'none';

                todoList.innerHTML = filteredTodos.map(todo => `
                    <div class="todo-item flex items-center p-4 border border-gray-200 rounded-lg priority-${todo.priority} ${todo.completed ? 'completed' : ''}" data-id="${todo.id}">
                        <input 
                            type="checkbox" 
                            class="mr-4 w-5 h-5 text-blue-600 rounded" 
                            ${todo.completed ? 'checked' : ''} 
                            onchange="todoManager.toggleTodo(${todo.id})"
                        >
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <h3 class="todo-text font-medium text-gray-900">${todo.title}</h3>
                                <span class="px-2 py-1 text-xs rounded-full ${this.getPriorityColor(todo.priority)}">
                                    ${this.getPriorityText(todo.priority)}
                                </span>
                            </div>
                            ${todo.description ? `<p class="text-sm text-gray-600">${todo.description}</p>` : ''}
                            ${todo.dueDate ? `<p class="text-xs text-gray-500 mt-1">ğŸ“… ${todo.dueDate}</p>` : ''}
                            <div class="text-xs text-gray-400 mt-1">
                                ìƒì„±: ${new Date(todo.createdAt).toLocaleString('ko-KR')}
                            </div>
                        </div>
                        <div class="todo-actions flex space-x-2">
                            <button 
                                onclick="todoManager.startEdit(${todo.id})" 
                                class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors btn-animate"
                            >
                                ìˆ˜ì •
                            </button>
                            <button 
                                onclick="todoManager.deleteTodo(${todo.id})" 
                                class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors btn-animate"
                            >
                                ì‚­ì œ
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            // í†µê³„ ë Œë”ë§
            renderStats() {
                const total = this.todos.length;
                const completed = this.todos.filter(t => t.completed).length;
                const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

                document.getElementById('totalCount').textContent = total;
                document.getElementById('completedCount').textContent = completed;
                document.getElementById('completionRate').textContent = rate + '%';
            }

            // í™œë™ í”¼ë“œ ë Œë”ë§
            renderActivities() {
                const activityFeed = document.getElementById('activityFeed');
                
                if (this.activities.length === 0) {
                    activityFeed.innerHTML = `
                        <div class="text-center text-gray-500 py-4">
                            <div class="text-2xl mb-2">ğŸ“</div>
                            <p class="text-sm">í™œë™ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    `;
                    return;
                }

                activityFeed.innerHTML = this.activities.map(activity => `
                    <div class="activity-item flex items-start space-x-2 p-2 rounded">
                        <div class="text-blue-500 mt-1">ğŸ“</div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm text-gray-900">${activity.text}</p>
                            <p class="text-xs text-gray-500">${activity.time}</p>
                        </div>
                    </div>
                `).join('');
            }

            // í•  ì¼ ìˆ˜ì • ì‹œì‘
            startEdit(id) {
                const todo = this.todos.find(t => t.id === id);
                if (!todo) return;

                const newTitle = prompt('ìƒˆë¡œìš´ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:', todo.title);
                if (newTitle !== null && newTitle.trim() !== todo.title) {
                    this.editTodo(id, newTitle);
                }
            }
        }

        // ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬ ì‹œìŠ¤í…œ
        class MigrationManager {
            constructor(todoManager) {
                this.todoManager = todoManager;
                this.statusElement = document.getElementById('migrationStatus');
            }

            // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            updateStatus(message, type = 'info') {
                if (this.statusElement) {
                    const colors = {
                        info: 'text-blue-600',
                        success: 'text-green-600',
                        error: 'text-red-600',
                        warning: 'text-yellow-600'
                    };
                    this.statusElement.className = `mt-3 text-sm ${colors[type] || colors.info}`;
                    this.statusElement.textContent = message;
                }
            }

            // Supabaseë¡œ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
            async exportToSupabase() {
                if (!isSupabaseConnected) {
                    this.updateStatus('Supabaseì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                if (!uiController.currentUser) {
                    this.updateStatus('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                    return;
                }

                try {
                    this.updateStatus('Supabaseë¡œ ì—…ë¡œë“œ ì¤‘...', 'info');
                    
                    const todos = this.todoManager.todos.map(todo => ({
                        id: todo.id,
                        user_id: uiController.currentUser.id,
                        title: todo.title,
                        description: todo.description || null,
                        priority: todo.priority,
                        start_date: todo.startDate || null,
                        due_date: todo.dueDate || null,
                        completed: todo.completed,
                        created_at: todo.createdAt,
                        updated_at: todo.updatedAt
                    }));

                    // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ í›„ ìƒˆë¡œ ì‚½ì…
                    const { error: deleteError } = await supabase
                        .from('todos')
                        .delete()
                        .eq('user_id', uiController.currentUser.id);

                    if (deleteError) throw deleteError;

                    if (todos.length > 0) {
                        const { error: insertError } = await supabase
                            .from('todos')
                            .insert(todos);

                        if (insertError) throw insertError;
                    }

                    this.updateStatus(`${todos.length}ê°œ í•  ì¼ì´ Supabaseë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                    this.todoManager.addActivity(`${todos.length}ê°œ í•  ì¼ì´ í´ë¼ìš°ë“œì— ë°±ì—…ë¨`);
                    this.todoManager.renderActivities();

                } catch (error) {
                    console.error('Supabase ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                    this.updateStatus('ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
            }

            // Supabaseì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            async importFromSupabase() {
                if (!isSupabaseConnected) {
                    this.updateStatus('Supabaseì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                if (!uiController.currentUser) {
                    this.updateStatus('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                    return;
                }

                try {
                    this.updateStatus('Supabaseì—ì„œ ê°€ì ¸ì˜¤ëŠ” ì¤‘...', 'info');

                    const { data, error } = await supabase
                        .from('todos')
                        .select('*')
                        .eq('user_id', uiController.currentUser.id)
                        .order('created_at', { ascending: false });

                    if (error) throw error;

                    if (data && data.length > 0) {
                        // ë¡œì»¬ ë°ì´í„° ë°±ì—…
                        const currentTodos = [...this.todoManager.todos];
                        
                        // ì„œë²„ ë°ì´í„°ë¡œ êµì²´
                        this.todoManager.todos = data.map(todo => ({
                            id: todo.id,
                            title: todo.title,
                            description: todo.description || '',
                            priority: todo.priority,
                            startDate: todo.start_date,
                            dueDate: todo.due_date,
                            completed: todo.completed,
                            createdAt: todo.created_at,
                            updatedAt: todo.updated_at
                        }));

                        // nextId ì—…ë°ì´íŠ¸
                        this.todoManager.nextId = Math.max(...this.todoManager.todos.map(t => t.id), 0) + 1;

                        this.todoManager.saveToStorage();
                        this.todoManager.renderAll();

                        this.updateStatus(`${data.length}ê°œ í•  ì¼ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`, 'success');
                        this.todoManager.addActivity(`${data.length}ê°œ í•  ì¼ì´ í´ë¼ìš°ë“œì—ì„œ ë™ê¸°í™”ë¨`);
                        this.todoManager.renderActivities();
                    } else {
                        this.updateStatus('ê°€ì ¸ì˜¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    }

                } catch (error) {
                    console.error('Supabase ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                    this.updateStatus('ê°€ì ¸ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
            }

            // íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
            exportToFile() {
                try {
                    const exportData = {
                        todos: this.todoManager.todos,
                        activities: this.todoManager.activities,
                        exported_at: new Date().toISOString(),
                        version: '1.0'
                    };

                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `teamtodo-backup-${new Date().toISOString().split('T')[0]}.json`;
                    link.click();

                    this.updateStatus('íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    this.todoManager.addActivity('í•  ì¼ ëª©ë¡ì´ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ì§');
                    this.todoManager.renderActivities();

                } catch (error) {
                    console.error('íŒŒì¼ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
                    this.updateStatus('íŒŒì¼ ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }

            // ìë™ ë™ê¸°í™” (ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰)
            async autoSync() {
                if (isSupabaseConnected && uiController.currentUser) {
                    try {
                        await this.exportToSupabase();
                    } catch (error) {
                        console.error('ìë™ ë™ê¸°í™” ì‹¤íŒ¨:', error);
                    }
                }
            }
        }

        // UI ì»¨íŠ¸ë¡¤ëŸ¬ (Google OAuth í†µí•©)
        class UIController {
            constructor() {
                this.currentUser = null;
                this.todos = [];
                this.permissionManager = new UserPermissionManager();
                this.initializeEventListeners();
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
            initializeEventListeners() {
                // íƒ­ ì „í™˜
                document.getElementById('loginTab').addEventListener('click', () => this.switchTab('login'));
                document.getElementById('signupTab').addEventListener('click', () => this.switchTab('signup'));

                // ì†Œì…œ ë¡œê·¸ì¸
                document.getElementById('googleLoginBtn').addEventListener('click', () => this.handleGoogleLogin());
                document.getElementById('googleSignupBtn').addEventListener('click', () => this.handleGoogleSignup());
                document.getElementById('demoLoginBtn').addEventListener('click', () => this.handleDemoLogin());

                // í¼ ì œì¶œ
                document.getElementById('loginForm').addEventListener('submit', (e) => this.handleLogin(e));
                document.getElementById('signupForm').addEventListener('submit', (e) => this.handleSignup(e));
                document.getElementById('todoForm').addEventListener('submit', (e) => this.handleTodoSubmit(e));

                // ë¡œê·¸ì•„ì›ƒ
                document.getElementById('logoutBtn').addEventListener('click', () => this.handleLogout());

                // ì‹¤ì‹œê°„ ê²€ì¦
                this.setupRealTimeValidation();
            }

            // ì‹¤ì‹œê°„ ê²€ì¦ ì„¤ì • (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
            setupRealTimeValidation() {
                // íšŒì›ê°€ì… í•„ë“œ ê²€ì¦
                document.getElementById('signupEmail').addEventListener('input', (e) => {
                    this.validateFieldWithUI('email', e.target.value, 'signupEmailError', 'signupEmailSuccess');
                });

                document.getElementById('signupUsername').addEventListener('input', (e) => {
                    this.validateFieldWithUI('username', e.target.value, 'signupUsernameError', 'signupUsernameSuccess');
                });

                document.getElementById('signupPassword').addEventListener('input', (e) => {
                    this.validatePasswordWithUI(e.target.value);
                });

                document.getElementById('signupPasswordConfirm').addEventListener('input', (e) => {
                    this.validatePasswordConfirm(e.target.value);
                });

                document.getElementById('signupFullName').addEventListener('input', (e) => {
                    this.validateRequiredField(e.target.value, 'signupFullNameError', 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                });

                // ë¡œê·¸ì¸ í•„ë“œ ê²€ì¦
                document.getElementById('loginEmail').addEventListener('input', (e) => {
                    this.validateFieldWithUI('email', e.target.value, 'loginEmailError');
                });

                // í•  ì¼ í•„ë“œ ê²€ì¦
                document.getElementById('todoTitle').addEventListener('input', (e) => {
                    this.validateFieldWithUI('todoTitle', e.target.value, 'todoTitleError', 'todoTitleSuccess');
                });

                document.getElementById('todoDescription').addEventListener('input', (e) => {
                    this.validateDescriptionLength(e.target.value);
                });

                // ë‚ ì§œ ê²€ì¦
                document.getElementById('todoStartDate').addEventListener('change', () => this.validateDates());
                document.getElementById('todoDueDate').addEventListener('change', () => this.validateDates());
            }

            // í•„ë“œ ê²€ì¦ with UI ì—…ë°ì´íŠ¸ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
            validateFieldWithUI(fieldName, value, errorElementId, successElementId = null) {
                if (!value.trim()) {
                    this.hideValidationMessage(errorElementId);
                    if (successElementId) this.hideValidationMessage(successElementId);
                    return;
                }

                validationSystem.validateField(fieldName, value, async (result) => {
                    if (result.isValid) {
                        this.hideValidationMessage(errorElementId);
                        
                        // ì¤‘ë³µ í™•ì¸ì´ í•„ìš”í•œ í•„ë“œ
                        if ((fieldName === 'email' || fieldName === 'username') && successElementId) {
                            const duplicateResult = await validationSystem.checkDuplicate(fieldName, value);
                            if (duplicateResult.isAvailable) {
                                this.showValidationSuccess(successElementId);
                            } else {
                                this.showValidationError(errorElementId, `ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ${fieldName === 'email' ? 'ì´ë©”ì¼' : 'ì‚¬ìš©ìëª…'}ì…ë‹ˆë‹¤`);
                            }
                        } else if (successElementId) {
                            this.showValidationSuccess(successElementId);
                        }
                    } else {
                        if (successElementId) this.hideValidationMessage(successElementId);
                        this.showValidationError(errorElementId, result.errors[0]);
                    }
                    
                    this.updateSubmitButtonState();
                });
            }

            // ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ with ê°•ë„ í‘œì‹œ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
            validatePasswordWithUI(password) {
                if (!password) {
                    this.hideValidationMessage('signupPasswordError');
                    this.updatePasswordStrength(null);
                    return;
                }

                validationSystem.validateField('password', password, (result) => {
                    if (result.isValid) {
                        this.hideValidationMessage('signupPasswordError');
                    } else {
                        this.showValidationError('signupPasswordError', result.errors[0]);
                    }
                    
                    // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ì—…ë°ì´íŠ¸
                    if (result.strength) {
                        this.updatePasswordStrength(result.strength);
                    }
                    
                    this.updateSubmitButtonState();
                });
            }

            // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ UI ì—…ë°ì´íŠ¸ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
            updatePasswordStrength(strength) {
                const bars = ['strengthBar1', 'strengthBar2', 'strengthBar3', 'strengthBar4'];
                const strengthText = document.getElementById('strengthText');

                if (!strength) {
                    bars.forEach(barId => {
                        const bar = document.getElementById(barId);
                        if (bar) bar.className = 'h-2 w-1/4 bg-gray-200 rounded';
                    });
                    if (strengthText) strengthText.textContent = '';
                    return;
                }

                const colors = {
                    red: 'bg-red-500',
                    yellow: 'bg-yellow-500',
                    blue: 'bg-blue-500',
                    green: 'bg-green-500'
                };

                bars.forEach((barId, index) => {
                    const bar = document.getElementById(barId);
                    if (bar) {
                        if (index < strength.level) {
                            bar.className = `h-2 w-1/4 ${colors[strength.color]} rounded`;
                        } else {
                            bar.className = 'h-2 w-1/4 bg-gray-200 rounded';
                        }
                    }
                });

                if (strengthText) {
                    strengthText.textContent = strength.text;
                    strengthText.className = `text-xs mt-1 text-${strength.color}-600`;
                }
            }

            // ë‚˜ë¨¸ì§€ ê²€ì¦ ë©”ì„œë“œë“¤ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
            validatePasswordConfirm(confirmPassword) {
                const password = document.getElementById('signupPassword').value;
                const errorElement = 'signupPasswordConfirmError';

                if (!confirmPassword) {
                    this.hideValidationMessage(errorElement);
                    return;
                }

                if (password !== confirmPassword) {
                    this.showValidationError(errorElement, 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                } else {
                    this.hideValidationMessage(errorElement);
                }

                this.updateSubmitButtonState();
            }

            validateRequiredField(value, errorElementId, message) {
                if (!value.trim()) {
                    this.showValidationError(errorElementId, message);
                } else {
                    this.hideValidationMessage(errorElementId);
                }
                this.updateSubmitButtonState();
            }

            validateDescriptionLength(description) {
                const maxLength = 500;
                const errorElement = 'todoDescriptionError';

                if (description.length > maxLength) {
                    this.showValidationError(errorElement, `ì„¤ëª…ì€ ${maxLength}ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤ (í˜„ì¬: ${description.length}ì)`);
                } else {
                    this.hideValidationMessage(errorElement);
                }
            }

            validateDates() {
                const startDate = document.getElementById('todoStartDate').value;
                const dueDate = document.getElementById('todoDueDate').value;
                const errorElement = 'todoDateError';

                if (startDate && dueDate && new Date(startDate) > new Date(dueDate)) {
                    this.showValidationError(errorElement, 'ì‹œì‘ ë‚ ì§œëŠ” ë§ˆê° ë‚ ì§œë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤');
                } else {
                    this.hideValidationMessage(errorElement);
                }
            }

            // UI í—¬í¼ ë©”ì„œë“œë“¤ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
            showValidationError(elementId, message) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                const input = element.previousElementSibling;
                
                element.textContent = message;
                element.classList.remove('hidden');
                if (input) {
                    input.classList.add('border-red-500', 'validation-error');
                    setTimeout(() => input.classList.remove('validation-error'), 300);
                }
            }

            showValidationSuccess(elementId) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                const input = element.parentElement.querySelector('input');
                
                element.classList.remove('hidden');
                if (input) {
                    input.classList.add('border-green-500', 'validation-success');
                    input.classList.remove('border-red-500');
                    setTimeout(() => input.classList.remove('validation-success'), 500);
                }
            }

            hideValidationMessage(elementId) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                const input = element.previousElementSibling || element.parentElement.querySelector('input');
                
                element.classList.add('hidden');
                if (input) {
                    input.classList.remove('border-red-500', 'border-green-500');
                }
            }

            updateSubmitButtonState() {
                // íšŒì›ê°€ì… ë²„íŠ¼
                const signupBtn = document.getElementById('signupBtn');
                if (signupBtn) {
                    const isSignupValid = this.isSignupFormValid();
                    signupBtn.disabled = !isSignupValid;
                }

                // í•  ì¼ ì¶”ê°€ ë²„íŠ¼
                const todoBtn = document.getElementById('todoSubmitBtn');
                if (todoBtn) {
                    const isTodoValid = this.isTodoFormValid();
                    todoBtn.disabled = !isTodoValid;
                }
            }

            isSignupFormValid() {
                const email = document.getElementById('signupEmail').value;
                const username = document.getElementById('signupUsername').value;
                const fullName = document.getElementById('signupFullName').value;
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('signupPasswordConfirm').value;

                const hasErrors = document.querySelectorAll('#signupForm .text-red-500:not(.hidden)').length > 0;

                return email && username && fullName && password && confirmPassword && 
                       password === confirmPassword && !hasErrors;
            }

            isTodoFormValid() {
                const title = document.getElementById('todoTitle').value;
                const hasErrors = document.querySelectorAll('#todoForm .text-red-500:not(.hidden)').length > 0;

                return title.trim() && !hasErrors;
            }

            // íƒ­ ì „í™˜ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
            switchTab(tab) {
                const loginTab = document.getElementById('loginTab');
                const signupTab = document.getElementById('signupTab');
                const loginForm = document.getElementById('loginForm');
                const signupForm = document.getElementById('signupForm');

                if (tab === 'login') {
                    loginTab.classList.add('bg-white', 'shadow-sm', 'text-blue-600');
                    loginTab.classList.remove('text-gray-600');
                    signupTab.classList.remove('bg-white', 'shadow-sm', 'text-blue-600');
                    signupTab.classList.add('text-gray-600');
                    loginForm.classList.remove('hidden');
                    signupForm.classList.add('hidden');
                } else {
                    signupTab.classList.add('bg-white', 'shadow-sm', 'text-blue-600');
                    signupTab.classList.remove('text-gray-600');
                    loginTab.classList.remove('bg-white', 'shadow-sm', 'text-blue-600');
                    loginTab.classList.add('text-gray-600');
                    signupForm.classList.remove('hidden');
                    loginForm.classList.add('hidden');
                }
            }

            // Google ë¡œê·¸ì¸ ì²˜ë¦¬
            async handleGoogleLogin() {
                if (!isSupabaseConnected) {
                    alert('ë°ëª¨ ëª¨ë“œì—ì„œëŠ” Google ë¡œê·¸ì¸ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë°ëª¨ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    return;
                }

                const googleBtn = document.getElementById('googleLoginBtn');
                const originalText = googleBtn.innerHTML;
                
                googleBtn.disabled = true;
                googleBtn.innerHTML = `
                    <div class="flex items-center justify-center">
                        <div class="w-5 h-5 border-2 border-gray-300 border-t-gray-600 rounded-full animate-spin mr-2"></div>
                        Google ë¡œê·¸ì¸ ì¤‘...
                    </div>
                `;

                try {
                    const { data, error } = await supabase.auth.signInWithOAuth({
                        provider: 'google',
                        options: {
                            redirectTo: window.location.origin
                        }
                    });

                    if (error) throw error;

                    // OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ì§„í–‰ë˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì¶”ê°€ ì²˜ë¦¬ ë¶ˆí•„ìš”
                } catch (error) {
                    console.error('Google ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                    alert('Google ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                } finally {
                    googleBtn.disabled = false;
                    googleBtn.innerHTML = originalText;
                }
            }

            // Google íšŒì›ê°€ì… ì²˜ë¦¬ (ë¡œê·¸ì¸ê³¼ ë™ì¼)
            async handleGoogleSignup() {
                return this.handleGoogleLogin();
            }

            // ë°ëª¨ ë¡œê·¸ì¸ ì²˜ë¦¬
            async handleDemoLogin() {
                this.currentUser = { 
                    id: 'demo-user',
                    email: 'demo@example.com', 
                    user_metadata: { full_name: 'ë°ëª¨ ì‚¬ìš©ì' } 
                };
                
                await validationSystem.loadUserStats();
                this.showMainApp();
                this.loadTodos();
            }

            // ì‚¬ìš©ì ìƒíƒœ ìƒˆë¡œê³ ì¹¨
            async refreshUserStatus() {
                if (!isSupabaseConnected || !this.currentUser) return;

                try {
                    const permissions = await this.permissionManager.checkUserPermissions(this.currentUser);
                    
                    if (permissions.isApproved) {
                        // ìŠ¹ì¸ë¨: ë©”ì¸ ì•±ìœ¼ë¡œ ì´ë™
                        await validationSystem.loadUserStats();
                        this.showMainApp();
                        this.loadTodos();
                    } else {
                        // ì—¬ì „íˆ ëŒ€ê¸° ì¤‘
                        alert('ì•„ì§ ìŠ¹ì¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    }
                } catch (error) {
                    console.error('ìƒíƒœ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                    alert('ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }

            // ì¸ì¦ëœ ì‚¬ìš©ì ì²˜ë¦¬
            async handleAuthenticatedUser(user) {
                this.currentUser = user;

                try {
                    // ì‚¬ìš©ì ê¶Œí•œ í™•ì¸
                    const permissions = await this.permissionManager.checkUserPermissions(user);
                    
                    if (permissions.isNewUser) {
                        // ìƒˆ ì‚¬ìš©ì: í™˜ì˜ ë©”ì‹œì§€ì™€ ìŠ¹ì¸ ëŒ€ê¸° ì•ˆë‚´
                        alert(`í™˜ì˜í•©ë‹ˆë‹¤! ${user.user_metadata?.full_name || user.email}ë‹˜\nê´€ë¦¬ì ìŠ¹ì¸ í›„ ëª¨ë“  ê¸°ëŠ¥ì„ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                    }

                    if (permissions.isApproved) {
                        // ìŠ¹ì¸ëœ ì‚¬ìš©ì: ë©”ì¸ ì•±ìœ¼ë¡œ ì´ë™
                        await validationSystem.loadUserStats();
                        this.showMainApp();
                        this.loadTodos();
                    } else {
                        // ìŠ¹ì¸ ëŒ€ê¸° ì¤‘: ëŒ€ê¸° í™”ë©´ í‘œì‹œ
                        this.permissionManager.showPendingApproval(user);
                    }

                } catch (error) {
                    console.error('ì‚¬ìš©ì ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    alert('ì‚¬ìš©ì ì •ë³´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    this.handleLogout();
                }
            }

            // ì´ë©”ì¼ ë¡œê·¸ì¸ ì²˜ë¦¬ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
            async handleLogin(e) {
                e.preventDefault();
                
                if (!isSupabaseConnected) {
                    // ë°ëª¨ ëª¨ë“œ: ìë™ ë¡œê·¸ì¸
                    this.handleDemoLogin();
                    return;
                }

                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const loginBtn = document.getElementById('loginBtn');

                loginBtn.disabled = true;
                loginBtn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';

                try {
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password
                    });

                    if (error) throw error;

                    await this.handleAuthenticatedUser(data.user);
                } catch (error) {
                    console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                    this.showValidationError('loginPasswordError', 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤');
                } finally {
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸';
                }
            }

            // ì´ë©”ì¼ íšŒì›ê°€ì… ì²˜ë¦¬
            async handleSignup(e) {
                e.preventDefault();
                
                if (!isSupabaseConnected) {
                    alert('ë°ëª¨ ëª¨ë“œì—ì„œëŠ” íšŒì›ê°€ì…ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ íƒ­ì—ì„œ ë°ëª¨ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (!this.isSignupFormValid()) return;

                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const fullName = document.getElementById('signupFullName').value;
                const username = document.getElementById('signupUsername').value;
                const signupBtn = document.getElementById('signupBtn');

                signupBtn.disabled = true;
                signupBtn.textContent = 'ê°€ì… ì¤‘...';

                try {
                    const { data, error } = await supabase.auth.signUp({
                        email: email,
                        password: password,
                        options: {
                            data: {
                                full_name: fullName,
                                nickname: username
                            }
                        }
                    });

                    if (error) throw error;

                    // ì‚¬ìš©ì í”„ë¡œí•„ì€ ì¸ì¦ í›„ ìë™ìœ¼ë¡œ ìƒì„±ë¨
                    if (data.user && !data.user.email_confirmed_at) {
                        alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì´ë©”ì¼ì„ í™•ì¸í•˜ì—¬ ê³„ì •ì„ í™œì„±í™”í•´ì£¼ì„¸ìš”.');
                        this.switchTab('login');
                    } else if (data.user) {
                        // ì´ë©”ì¼ í™•ì¸ì´ í•„ìš” ì—†ëŠ” ê²½ìš° ë°”ë¡œ ì²˜ë¦¬
                        await this.handleAuthenticatedUser(data.user);
                    }
                } catch (error) {
                    console.error('íšŒì›ê°€ì… ì‹¤íŒ¨:', error);
                    if (error.message.includes('already registered')) {
                        this.showValidationError('signupEmailError', 'ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤');
                    } else {
                        alert('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    }
                } finally {
                    signupBtn.disabled = false;
                    signupBtn.textContent = 'ì´ë©”ì¼ë¡œ íšŒì›ê°€ì…';
                }
            }

            // í•  ì¼ ì¶”ê°€ ì²˜ë¦¬
            async handleTodoSubmit(e) {
                e.preventDefault();
                if (!this.isTodoFormValid()) return;

                const title = document.getElementById('todoTitle').value.trim();
                const description = document.getElementById('todoDescription').value.trim();
                const priority = document.getElementById('todoPriority').value;
                const startDate = document.getElementById('todoStartDate').value;
                const dueDate = document.getElementById('todoDueDate').value;
                const submitBtn = document.getElementById('todoSubmitBtn');

                submitBtn.disabled = true;
                submitBtn.textContent = 'ì¶”ê°€ ì¤‘...';

                try {
                    // TodoManagerë¥¼ í†µí•´ í•  ì¼ ì¶”ê°€
                    todoManager.addTodo(title, description, priority, startDate, dueDate);
                    
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('todoForm').reset();
                    this.hideValidationMessage('todoTitleSuccess');
                    this.updateSubmitButtonState();

                    // ê²€ì¦ ì‹œìŠ¤í…œì— ì„±ê³µ ê¸°ë¡
                    validationSystem.recordValidation('todo', 'success');

                    // ìë™ ë™ê¸°í™” (Supabase ì—°ê²° ì‹œ)
                    if (isSupabaseConnected && this.currentUser) {
                        setTimeout(() => {
                            migrationManager.autoSync();
                        }, 2000);
                    }

                } catch (error) {
                    console.error('í•  ì¼ ì¶”ê°€ ì‹¤íŒ¨:', error);
                    validationSystem.recordValidation('todo', 'failed');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'í•  ì¼ ì¶”ê°€';
                }
            }

            // í•  ì¼ ëª©ë¡ ë¡œë“œ
            async loadTodos() {
                try {
                    // TodoManagerë¥¼ í†µí•´ ë¡œë“œ
                    todoManager.loadFromStorage();
                    
                    // Supabase ì—°ê²° ì‹œ ì„œë²„ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    if (isSupabaseConnected && this.currentUser) {
                        await migrationManager.importFromSupabase();
                    }
                } catch (error) {
                    console.error('í•  ì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            }

            // í•  ì¼ ëª©ë¡ ë Œë”ë§ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
            renderTodos() {
                const todoList = document.getElementById('todoList');
                const emptyState = document.getElementById('emptyState');

                if (this.todos.length === 0) {
                    todoList.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                    return;
                }

                todoList.classList.remove('hidden');
                emptyState.classList.add('hidden');

                todoList.innerHTML = this.todos.map(todo => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900 mb-1">${todo.title}</h3>
                                ${todo.description ? `<p class="text-gray-600 text-sm mb-2">${todo.description}</p>` : ''}
                                <div class="flex items-center space-x-4 text-xs text-gray-500">
                                    <span class="px-2 py-1 rounded-full ${this.getPriorityClass(todo.priority)}">${this.getPriorityText(todo.priority)}</span>
                                    <span class="px-2 py-1 rounded-full ${this.getStatusClass(todo.status)}">${this.getStatusText(todo.status)}</span>
                                    ${todo.due_date ? `<span>ë§ˆê°: ${todo.due_date}</span>` : ''}
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="uiController.updateTodoStatus('${todo.id}', '${todo.status === 'completed' ? 'pending' : 'completed'}')" 
                                        class="px-3 py-1 text-xs rounded-md ${todo.status === 'completed' ? 'bg-gray-100 text-gray-600' : 'bg-green-100 text-green-600'} hover:opacity-80">
                                    ${todo.status === 'completed' ? 'ë¯¸ì™„ë£Œ' : 'ì™„ë£Œ'}
                                </button>
                                <button onclick="uiController.deleteTodo('${todo.id}')" 
                                        class="px-3 py-1 text-xs rounded-md bg-red-100 text-red-600 hover:opacity-80">
                                    ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // ìš°ì„ ìˆœìœ„/ìƒíƒœ ê´€ë ¨ í—¬í¼ ë©”ì„œë“œë“¤ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
            getPriorityClass(priority) {
                const classes = {
                    high: 'bg-red-100 text-red-600',
                    medium: 'bg-yellow-100 text-yellow-600',
                    low: 'bg-green-100 text-green-600'
                };
                return classes[priority] || classes.medium;
            }

            getPriorityText(priority) {
                const texts = {
                    high: 'ë†’ìŒ',
                    medium: 'ë³´í†µ',
                    low: 'ë‚®ìŒ'
                };
                return texts[priority] || texts.medium;
            }

            getStatusClass(status) {
                const classes = {
                    pending: 'bg-gray-100 text-gray-600',
                    in_progress: 'bg-blue-100 text-blue-600',
                    completed: 'bg-green-100 text-green-600'
                };
                return classes[status] || classes.pending;
            }

            getStatusText(status) {
                const texts = {
                    pending: 'ëŒ€ê¸°',
                    in_progress: 'ì§„í–‰ì¤‘',
                    completed: 'ì™„ë£Œ'
                };
                return texts[status] || texts.pending;
            }

            // í•  ì¼ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì—°ê²° ìƒíƒœì— ë”°ë¼ ë¶„ê¸°)
            async updateTodoStatus(todoId, newStatus) {
                try {
                    if (!isSupabaseConnected) {
                        // ë°ëª¨ ëª¨ë“œ: ë¡œì»¬ ë°ì´í„° ì—…ë°ì´íŠ¸
                        const todoIndex = this.todos.findIndex(todo => todo.id === todoId);
                        if (todoIndex !== -1) {
                            this.todos[todoIndex].status = newStatus;
                            this.todos[todoIndex].completed_at = newStatus === 'completed' ? new Date().toISOString() : null;
                            localStorage.setItem('demo_todos', JSON.stringify(this.todos));
                        }
                    } else {
                        const { error } = await supabase
                            .from('todos')
                            .update({ 
                                status: newStatus,
                                completed_at: newStatus === 'completed' ? new Date().toISOString() : null
                            })
                            .eq('id', todoId);

                        if (error) throw error;
                    }

                    this.loadTodos();
                } catch (error) {
                    console.error('í•  ì¼ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    alert('ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }
            }

            // í•  ì¼ ì‚­ì œ (ì—°ê²° ìƒíƒœì— ë”°ë¼ ë¶„ê¸°)
            async deleteTodo(todoId) {
                if (!confirm('ì •ë§ë¡œ ì´ í•  ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

                try {
                    if (!isSupabaseConnected) {
                        // ë°ëª¨ ëª¨ë“œ: ë¡œì»¬ ë°ì´í„°ì—ì„œ ì‚­ì œ
                        this.todos = this.todos.filter(todo => todo.id !== todoId);
                        localStorage.setItem('demo_todos', JSON.stringify(this.todos));
                    } else {
                        const { error } = await supabase
                            .from('todos')
                            .delete()
                            .eq('id', todoId);

                        if (error) throw error;
                    }

                    this.loadTodos();
                } catch (error) {
                    console.error('í•  ì¼ ì‚­ì œ ì‹¤íŒ¨:', error);
                    alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }
            }

            // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
            async handleLogout() {
                try {
                    if (isSupabaseConnected) {
                        await supabase.auth.signOut();
                    }
                    this.currentUser = null;
                    this.showAuthScreen();
                } catch (error) {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
                }
            }

            // í™”ë©´ ì „í™˜
            showAuthScreen() {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('authScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }

            showMainApp() {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');

                // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                const userInfoElement = document.getElementById('userInfo');
                if (userInfoElement) {
                    const userName = this.currentUser.user_metadata?.full_name || this.currentUser.email || 'ì‚¬ìš©ì';
                    userInfoElement.textContent = `${userName}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
                }
            }
        }

        // ì „ì—­ ë³€ìˆ˜ ì„ ì–¸
        let validationSystem = null;
        let uiController = null;
        let todoManager = null;
        let migrationManager = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            // í•  ì¼ ê´€ë¦¬ì ì´ˆê¸°í™”
            todoManager = new TodoManager();
            
            // UI ì»¨íŠ¸ë¡¤ëŸ¬ ì´ˆê¸°í™”
            uiController = new UIController();
            
            // ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬ì ì´ˆê¸°í™”
            migrationManager = new MigrationManager(todoManager);
            
            // ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘
            const initializer = new SystemInitializer();
            await initializer.initialize();

            // Supabase ì¸ì¦ ìƒíƒœ ë³€í™” ë¦¬ìŠ¤ë„ˆ (ì—°ê²°ë˜ì–´ ìˆëŠ” ê²½ìš°ë§Œ)
            if (isSupabaseConnected && supabase) {
                supabase.auth.onAuthStateChange(async (event, session) => {
                    console.log('ì¸ì¦ ìƒíƒœ ë³€í™”:', event, session?.user?.email);
                    
                    if (event === 'SIGNED_IN' && session?.user) {
                        // ë¡œê·¸ì¸ ì„±ê³µ
                        await uiController.handleAuthenticatedUser(session.user);
                    } else if (event === 'SIGNED_OUT') {
                        // ë¡œê·¸ì•„ì›ƒ
                        uiController.currentUser = null;
                        uiController.showAuthScreen();
                    } else if (event === 'TOKEN_REFRESHED') {
                        // í† í° ê°±ì‹  - í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
                        if (session?.user && uiController.currentUser) {
                            uiController.currentUser = session.user;
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>